#!/bin/bash

echo "üü© –ü–æ—á–∏–Ω–∞—î–º–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è YOLOv5-–ø—Ä–æ—î–∫—Ç—É..."

# –ù–∞–∑–≤–∞ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ—Ç–æ—á–µ–Ω–Ω—è
ENV_NAME="yolov5-env"

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ Python 3.10+ (–∞–±–æ —ñ–Ω—à–∏–π –±–∞–∂–∞–Ω–∏–π)
if ! command -v python3 &> /dev/null
then
    echo "‚ùå Python3 –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ. –í—Å—Ç–∞–Ω–æ–≤–∏ Python 3 –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è–º."
    exit 1
fi

# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
echo "üîß –°—Ç–≤–æ—Ä—é—î–º–æ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ '$ENV_NAME'..."
python3 -m venv "$ENV_NAME"

# –ê–∫—Ç–∏–≤–∞—Ü—ñ—è –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
echo "‚öôÔ∏è –ê–∫—Ç–∏–≤—É—î–º–æ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ..."
source "$ENV_NAME/bin/activate"

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ —Ñ–∞–π–ª—É requirements.txt —É —Ü—ñ–π –∂–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó
REQ_FILE="$(dirname "$0")/requirements.txt"

if [ ! -f "$REQ_FILE" ]; then
    echo "‚ùå –ü–æ–º–∏–ª–∫–∞: —Ñ–∞–π–ª 'requirements.txt' –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ –ø–æ—Ç–æ—á–Ω—ñ–π –ø–∞–ø—Ü—ñ."
    echo "   –ü–æ—Ç–æ—á–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è: $(pwd)"
    echo "   –û—á—ñ–∫—É–≤–∞–Ω–∏–π —à–ª—è—Ö: $REQ_FILE"
    echo "‚û°Ô∏è –°–ø–æ—á–∞—Ç–∫—É —Å—Ç–≤–æ—Ä–∏ requirements.txt –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Ü—å–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞."
    deactivate
    exit 1
fi

# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
echo "üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –∑ $REQ_FILE ..."
pip install --upgrade pip
pip install -r "$REQ_FILE"

echo "‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞."
echo "üëâ –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –∞–∫—Ç–∏–≤–∞—Ü—ñ—è —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞: source $ENV_NAME/bin/activate"
